<Window x:Class="FixMyTex.Features.QuickActions.Views.QuickActionsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:FixMyTex.Features.QuickActions.Views"
        xmlns:viewModels="clr-namespace:FixMyTex.Features.QuickActions.ViewModels"
        mc:Ignorable="d"
        Title="Quick Actions" 
        Width="1000" Height="700"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResize"
        WindowStartupLocation="CenterScreen"
        ShowInTaskbar="False"
        Topmost="True"
        KeyDown="Window_KeyDown">
    
    <Window.Resources>
        <viewModels:StringToBrushConverter x:Key="StringToBrushConverter"/>
        <viewModels:NumberToVisibilityConverter x:Key="NumberToVisibilityConverter"/>
        <viewModels:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <viewModels:CategoryToBrushConverter x:Key="CategoryToBrushConverter"/>
    </Window.Resources>
    
    <Border Background="#1E1E1E" BorderBrush="#333333" BorderThickness="1" CornerRadius="10">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Header -->
            <Border Grid.Row="0" 
                    Background="#252525"
                    BorderThickness="0,0,0,1"
                    BorderBrush="#333333"
                    MouseLeftButtonDown="Header_MouseLeftButtonDown">
                <Grid Margin="12,8">
                    <StackPanel Orientation="Horizontal">
                        <Image Source="/icons8-mutig-ai-32.png" Width="24" Height="24" Margin="0,0,8,0"/>
                        <TextBlock Text="FixMyTex" 
                                   Foreground="White" 
                                   FontSize="16" 
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button x:Name="SettingsButton"
                                Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"
                                Margin="4,0"
                                ToolTip="Settings"
                                Click="SettingsButton_Click">
                            <Path Data="M9.3,2.2 L10.7,2.2 C11.3,2.2 11.8,2.7 11.9,3.3 L12.1,4.7 C12.3,4.9 12.5,5 12.6,5.1 L14,4.5 C14.6,4.3 15.2,4.5 15.5,5.1 L16.2,6.4 C16.5,6.9 16.4,7.6 16,8 L14.9,9 C14.9,9.3 14.9,9.7 14.9,10 C14.9,10.3 14.9,10.7 14.9,11 L16,12 C16.4,12.4 16.5,13.1 16.2,13.6 L15.5,14.9 C15.2,15.5 14.6,15.7 14,15.5 L12.6,14.9 C12.4,15 12.3,15.1 12.1,15.3 L11.9,16.7 C11.8,17.3 11.3,17.8 10.7,17.8 L9.3,17.8 C8.7,17.8 8.2,17.3 8.1,16.7 L7.9,15.3 C7.7,15.1 7.5,15 7.4,14.9 L6,15.5 C5.4,15.7 4.8,15.5 4.5,14.9 L3.8,13.6 C3.5,13.1 3.6,12.4 4,12 L5.1,11 C5.1,10.7 5.1,10.3 5.1,10 C5.1,9.7 5.1,9.3 5.1,9 L4,8 C3.6,7.6 3.5,6.9 3.8,6.4 L4.5,5.1 C4.8,4.5 5.4,4.3 6,4.5 L7.4,5.1 C7.6,5 7.7,4.9 7.9,4.7 L8.1,3.3 C8.2,2.7 8.7,2.2 9.3,2.2 Z M10,13.5 C11.9,13.5 13.5,11.9 13.5,10 C13.5,8.1 11.9,6.5 10,6.5 C8.1,6.5 6.5,8.1 6.5,10 C6.5,11.9 8.1,13.5 10,13.5 Z"
                                  Fill="#CCCCCC"
                                  Width="18" Height="18"
                                  Stretch="Uniform"/>
                        </Button>
                        
                        <Button x:Name="CloseButton"
                                Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"
                                
                                Margin="4,0"
                                Click="CloseButton_Click"
                                ToolTip="Close">
                            <Path Data="M0,0 L10,10 M0,10 L10,0"
                                  Stroke="#CCCCCC"
                                  StrokeThickness="1.5"
                                  Width="10" Height="10"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- Categories -->
            <ScrollViewer Grid.Row="1" 
                          HorizontalScrollBarVisibility="Auto" 
                          VerticalScrollBarVisibility="Disabled"
                          Padding="8">
                <ItemsControl ItemsSource="{Binding Categories}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <local:CategoryControl 
                                Title="{Binding Title}"
                                Color="{Binding Color}"
                                QuickActions="{Binding QuickActions}"
                                AdditionalOptions="{Binding AdditionalOptions}"
                                SelectQuickActionCommand="{Binding DataContext.SelectQuickActionCommand, 
                                    RelativeSource={RelativeSource AncestorType=Window}}"
                                Width="180"
                                Height="100"
                                Margin="4"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
            
            <!-- Text Comparison -->
            <Grid Grid.Row="2" Margin="12,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Original Text Section -->
                <Border Grid.Column="0" 
                        Background="#252525" 
                        BorderBrush="#333333" 
                        BorderThickness="1" 
                        CornerRadius="8"
                        Margin="0,8,8,8">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" 
                                   Text="Original Text:" 
                                   Foreground="#AAAAAA"
                                   FontSize="14"
                                   Margin="12,8"/>
                        
                        <TextBox Grid.Row="1" 
                                 Text="{Binding OriginalText, UpdateSourceTrigger=PropertyChanged}"
                                 Background="Transparent"
                                 Foreground="White"
                                 BorderThickness="0"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Auto"
                                 Margin="12,0,12,12"/>
                    </Grid>
                </Border>
                
                <!-- Enhanced Text Section -->
                <Border Grid.Column="1" 
                        Background="#252525" 
                        BorderBrush="#333333" 
                        BorderThickness="1" 
                        CornerRadius="8"
                        Margin="8,8,0,8">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" 
                                   Text="Enhanced Text:" 
                                   Foreground="#4CAF50"
                                   FontSize="14"
                                   Margin="12,8"/>
                        
                        <TextBox Grid.Row="1" 
                                 Text="{Binding EnhancedText, UpdateSourceTrigger=PropertyChanged}"
                                 Background="Transparent"
                                 Foreground="White"
                                 BorderThickness="0"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Auto"
                                 Margin="12,0,12,12"
                                 IsReadOnly="True"/>
                        
                        <!-- Loading Indicator -->
                        <Border Grid.Row="1"
                                Background="#80000000"
                                Visibility="{Binding IsEnhancing, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <TextBlock Text="Enhancing text..." 
                                           Foreground="White" 
                                           FontSize="16"
                                           Margin="0,0,0,8"/>
                                <ProgressBar IsIndeterminate="True" 
                                             Width="200" 
                                             Height="4"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
            
            <!-- Bottom Panel -->
            <Grid Grid.Row="3" Margin="12,0,12,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Active Enhancements Panel -->
                <Border Grid.Column="0" 
                        Background="#252525" 
                        BorderBrush="#333333" 
                        BorderThickness="1" 
                        CornerRadius="8"
                        Margin="0,0,8,0"
                        MinHeight="80"
                        Padding="12">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" 
                                   Text="Active Enhancements:" 
                                   Foreground="#AAAAAA"
                                   FontSize="14"
                                   Margin="0,0,0,8"/>
                        
                        <ItemsControl Grid.Row="1" 
                                      ItemsSource="{Binding ActiveQuickActions}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding Category, Converter={StaticResource CategoryToBrushConverter}}"
                                            CornerRadius="16" 
                                            Padding="10,4" 
                                            Margin="4">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding Category}" 
                                                       Foreground="White" 
                                                       FontSize="12" 
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,4,0"/>
                                            <TextBlock Text="â†’" 
                                                       Foreground="White" 
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,4,0"/>
                                            <TextBlock Text="{Binding Name}" 
                                                       Foreground="White" 
                                                       FontSize="12"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Grid>
                </Border>
                
                <!-- Action Buttons -->
                <Border Grid.Column="1" 
                        Background="#252525" 
                        BorderBrush="#333333" 
                        BorderThickness="1" 
                        CornerRadius="8"
                        Margin="8,0,0,0"
                        MinHeight="80"
                        Padding="16">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" 
                                   Text="Actions:" 
                                   Foreground="#AAAAAA"
                                   FontSize="14"
                                   Margin="0,0,0,8"/>
                        
                        <StackPanel Grid.Row="1" Orientation="Horizontal">
                            <Button Content="Apply (Enter)" 
                                    Background="#2196F3" 
                                    Foreground="White"
                                    BorderThickness="0"
                                    Padding="16,8"
                                    Margin="0,0,8,0"
                                    Command="{Binding ApplyEnhancementsCommand}"/>
                            
                            <Button Content="Cancel (Esc)" 
                                    Background="#333333" 
                                    Foreground="White"
                                    BorderThickness="0"
                                    Padding="16,8"
                                    Margin="0,0,8,0"
                                    Command="{Binding CancelCommand}"/>
                            
                            <Button Content="Save Preset" 
                                    Background="#333333" 
                                    Foreground="White"
                                    BorderThickness="0"
                                    Padding="16,8"
                                    Margin="0,0,8,0"
                                    Command="{Binding SavePresetCommand}"/>
                            
                            <Button Content="Advanced" 
                                    Background="#333333" 
                                    Foreground="White"
                                    BorderThickness="0"
                                    Padding="16,8"
                                    Margin="0"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
            
            <!-- Keyboard Help -->
            <TextBlock Grid.Row="3" 
                       Text="Press 1-3 to select category, then 1-3 for option" 
                       Foreground="#666666"
                       TextAlignment="Center"
                       Margin="0,0,0,4"
                       VerticalAlignment="Bottom"/>
        </Grid>
    </Border>
</Window>