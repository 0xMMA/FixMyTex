<Window x:Class="FixMyTex.Features.QuickActions.Views.QuickActionsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:FixMyTex.Features.QuickActions.Views"
        xmlns:viewModels="clr-namespace:FixMyTex.Features.QuickActions.ViewModels"
        xmlns:ic="clr-namespace:FluentIcons.Wpf;assembly=FluentIcons.Wpf"
        mc:Ignorable="d"
        Title="Quick Actions" 
        Width="1000" Height="700"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResize"
        WindowStartupLocation="CenterScreen"
        ShowInTaskbar="False"
        Topmost="True"
        KeyDown="Window_KeyDown">
    
    <Window.Resources>
        <viewModels:StringToBrushConverter x:Key="StringToBrushConverter"/>
        <viewModels:NumberToVisibilityConverter x:Key="NumberToVisibilityConverter"/>
        <viewModels:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <viewModels:CategoryToBrushConverter x:Key="CategoryToBrushConverter"/>
    </Window.Resources>
    
    <Border Background="#1E1E1E" BorderBrush="#333333" BorderThickness="1" CornerRadius="10">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Header -->
            <Border Grid.Row="0" 
                    Background="#252525"
                    BorderThickness="0,0,0,1"
                    BorderBrush="#333333"
                    MouseLeftButtonDown="Header_MouseLeftButtonDown">
                <Grid Margin="12,8">
                    <StackPanel Orientation="Horizontal">
                        <Image Source="/icons8-mutig-ai-32.png" Width="24" Height="24" Margin="0,0,8,0"/>
                        <TextBlock Text="FixMyTex" 
                                   Foreground="White" 
                                   FontSize="16" 
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button x:Name="SettingsButton"
                                Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"
                                Margin="4,0"
                                ToolTip="Settings"
                                Click="SettingsButton_Click">
                            <ic:FluentIcon Icon="Settings" IconVariant="Regular" IconSize="Size20" Foreground="#CCCCCC"/>
                        </Button>
                        
                        <Button x:Name="CloseButton"
                                Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"
                                Margin="4,0"
                                Click="CloseButton_Click"
                                ToolTip="Close">
                            <ic:FluentIcon Icon="Dismiss" IconVariant="Regular" IconSize="Size20" Foreground="#CCCCCC"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- Categories -->
            <ScrollViewer Grid.Row="1" 
                          HorizontalScrollBarVisibility="Auto" 
                          VerticalScrollBarVisibility="Disabled"
                          Padding="8">
                <ItemsControl ItemsSource="{Binding Categories}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <local:CategoryControl 
                                Title="{Binding Title}"
                                Color="{Binding Color}"
                                QuickActions="{Binding QuickActions}"
                                AdditionalOptions="{Binding AdditionalOptions}"
                                SelectQuickActionCommand="{Binding DataContext.SelectQuickActionCommand, 
                                    RelativeSource={RelativeSource AncestorType=Window}}"
                                Width="180"
                                Height="100"
                                Margin="4"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
            
            <!-- Text Comparison -->
            <Grid Grid.Row="2" Margin="12,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Original Text Section -->
                <Border Grid.Column="0" 
                        Background="#252525" 
                        BorderBrush="#333333" 
                        BorderThickness="1" 
                        CornerRadius="8"
                        Margin="0,8,8,8">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" 
                                   Text="Original Text:" 
                                   Foreground="#AAAAAA"
                                   FontSize="14"
                                   Margin="12,8"/>
                        
                        <TextBox Grid.Row="1" 
                                 Text="{Binding OriginalText, UpdateSourceTrigger=PropertyChanged}"
                                 Background="Transparent"
                                 Foreground="White"
                                 BorderThickness="0"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Auto"
                                 Margin="12,0,12,12"/>
                    </Grid>
                </Border>
                
                <!-- Enhanced Text Section -->
                <Border Grid.Column="1" 
                        Background="#252525" 
                        BorderBrush="#333333" 
                        BorderThickness="1" 
                        CornerRadius="8"
                        Margin="8,8,0,8">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" 
                                   Text="Enhanced Text:" 
                                   Foreground="#4CAF50"
                                   FontSize="14"
                                   Margin="12,8"/>
                        
                        <TextBox Grid.Row="1" 
                                 Text="{Binding EnhancedText, UpdateSourceTrigger=PropertyChanged}"
                                 Background="Transparent"
                                 Foreground="White"
                                 BorderThickness="0"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Auto"
                                 Margin="12,0,12,12"
                                 IsReadOnly="True"/>
                        
                        <!-- Loading Indicator -->
                        <Border Grid.Row="1"
                                Background="#80000000"
                                Visibility="{Binding IsEnhancing, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <TextBlock Text="Enhancing text..." 
                                           Foreground="White" 
                                           FontSize="16"
                                           Margin="0,0,0,8"/>
                                <ProgressBar IsIndeterminate="True" 
                                             Width="200" 
                                             Height="4"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
            
            <!-- Bottom Panel -->
            <Grid Grid.Row="3" Margin="12,0,12,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Active Enhancements Panel -->
                <Border Grid.Column="0" 
                        Background="#252525" 
                        BorderBrush="#333333" 
                        BorderThickness="1" 
                        CornerRadius="8"
                        Margin="0,0,8,0"
                        Padding="13">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" 
                                   Text="Active Enhancements:" 
                                   Foreground="#AAAAAA"
                                   FontSize="14"
                                   Margin="0,0,0,8"/>
                        
                        <ItemsControl Grid.Row="1" 
                                      ItemsSource="{Binding ActiveQuickActions}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding Category, Converter={StaticResource CategoryToBrushConverter}}"
                                            CornerRadius="16" 
                                            Padding="10,4" 
                                            Margin="4">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding Category}" 
                                                       Foreground="White" 
                                                       FontSize="12" 
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,4,0"/>
                                            <TextBlock Text="â†’" 
                                                       Foreground="White" 
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,4,0"/>
                                            <TextBlock Text="{Binding Name}" 
                                                       Foreground="White" 
                                                       FontSize="12"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Grid>
                </Border>
                
                <!-- Action Buttons -->
                <Border Grid.Column="1" 
                        Background="#252525" 
                        BorderBrush="#333333" 
                        BorderThickness="1" 
                        CornerRadius="8"
                        Margin="8,0,0,0"
                        Padding="13">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" 
                                   Text="Actions:" 
                                   Foreground="#AAAAAA"
                                   FontSize="14"
                                   Margin="0,0,0,8"/>
                        
                        <StackPanel Grid.Row="1" Orientation="Horizontal">
                            
                            
                           
                            
                            <Button Background="#333333" 
                                    Foreground="White"
                                    BorderThickness="0"
                                    Padding="13,8,13,4"
                                    Margin="0,0,8,0"
                                    Command="{Binding SavePresetCommand}">
                                <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Icon -->
                                    <ic:FluentIcon Grid.Row="0" Grid.Column="0" 
                                                   Icon="Save" IconVariant="Regular" IconSize="Size20" 
                                                   Margin="0,0,8,0"/>

                                    <!-- Save Preset Text -->
                                    <TextBlock Grid.Row="0" Grid.Column="1" 
                                               Text="Save Preset" Style="{StaticResource ButtonPrimaryTextStyle}"/>
                                               
                                    <!-- Spacer to match buttons with shortcuts -->
                                    <TextBlock Grid.Row="1" Grid.Column="1" 
                                               Text=" " 
                                               Style="{StaticResource ButtonSecondaryTextStyle}" />
                                </Grid>
                            </Button>

                            <Button Background="#333333" 
                                    Foreground="White"
                                    BorderThickness="0"
                                    Padding="13,8,13,4"
                                    Margin="0,0,8,0"
                                    Command="{Binding CancelCommand}">
                                <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Icon -->
                                    <ic:FluentIcon Grid.Row="0" Grid.Column="0" 
                                                   Icon="Dismiss" IconVariant="Regular" IconSize="Size20" 
                                                   Margin="0,0,8,0"/>

                                    <!-- Cancel Text -->
                                    <TextBlock Grid.Row="0" Grid.Column="1" 
                                               Text="Cancel" Style="{StaticResource ButtonPrimaryTextStyle}"/>

                                    <!-- Esc Text - positioned under Cancel -->
                                    <TextBlock Grid.Row="1" Grid.Column="1" 
                                               Text="(Esc)" 
                                               Style="{StaticResource ButtonSecondaryTextStyle}"
                                                />
                                </Grid>
                            </Button>

                            <Button Background="#2196F3" 
                                    Foreground="White"
                                    BorderThickness="0"
                                    Padding="13,8,13,4"
                                    Margin="0,0,8,0"
                                    Command="{Binding ApplyEnhancementsCommand}">
                                <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Icon -->
                                    <ic:FluentIcon Grid.Row="0" Grid.Column="0"  
                                                   Icon="ArrowCircleRight" IconVariant="Regular" IconSize="Size20" 
                                                   Margin="0,0,8,0"/>

                                    <!-- Apply Text -->
                                    <TextBlock Grid.Row="0" Grid.Column="1" 
                                               Text="Apply" Style="{StaticResource ButtonPrimaryTextStyle}"/>

                                    <!-- Enter Text - positioniert unter Apply -->
                                    <TextBlock Grid.Row="1" Grid.Column="1" 
                                               Text="(Enter)" 
                                               Style="{StaticResource ButtonSecondaryTextStyle}" />
                                </Grid>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
            
            <!-- Keyboard Help -->
            <TextBlock Grid.Row="3" 
                       Text="Press 1-3 to select category, then 1-3 for option" 
                       Foreground="#666666"
                       TextAlignment="Center"
                       Margin="0,0,0,4"
                       VerticalAlignment="Bottom"/>
        </Grid>
    </Border>
</Window>